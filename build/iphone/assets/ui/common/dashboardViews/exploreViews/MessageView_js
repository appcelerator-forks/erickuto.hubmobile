function messageView(e){function a(e){var t=Ti.UI.createView({backgroundColor:hub.API.customBgColor,layout:"vertical"}),i=[];return t.add(n),r(e),t}hub=require("hub");var t=(hub.API.app_width-350*hub.API.wsf)/2,n=Ti.UI.createScrollView({top:5,layout:"vertical"}),r=function(e){var t=[],n=Ti.UI.createTableViewRow({layout:"vertical",height:Ti.UI.SIZE,hasChild:!1,touchEnabled:!1,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,focusable:!1}),r=Ti.UI.createTableViewRow({layout:"vertical",height:Ti.UI.SIZE,hasChild:!1,touchEnabled:!1,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,focusable:!1});messages=e.messages;for(var s=0;s<messages.length;s++)n.add(o(messages[s],"message"));var u=Ti.UI.createView({backgroundColor:"e5eaf0",bottom:1,width:hub.API.app_width-2,height:125,right:1,left:0,borderColor:"#e0e0e0",borderWidth:1,layout:"horizontal"}),a=Ti.UI.createView({layout:"horizontal",top:0,left:0}),f=Ti.UI.createImageView({image:"blah.jpg",width:50,top:0,left:0}),l=Ti.UI.createView({top:0,left:2}),c=Ti.UI.createView({layout:"vertical",height:120,width:hub.API.app_width-60}),h=Ti.UI.createTextArea({borderWidth:2,borderColor:"#bbb",borderRadius:5,color:"#888",font:{fontSize:15},textAlign:"left",hintText:"I am a textarea",top:0,left:5,width:"97%",height:70}),p=Ti.UI.createImageView({image:hub.API.imagePath("reply.png"),width:75,top:5,right:5});c.add(h,p),a.add(f,c),u.add(a),r.add(u),t.push(n,r);var d=Ti.UI.createTableView({data:t,top:0});d.scrollToIndex(t.length-1,{position:Ti.UI.iPhone.TableViewScrollPosition.BOTTOM}),i(d)},i=function(e){n.add(e)},s=function(e){r(data)},o=function(e,t){var n=Ti.UI.createTableView({}),r=Ti.UI.createView({backgroundColor:"e5eaf0",bottom:1,width:hub.API.app_width-2,right:1,left:0,borderColor:"#e0e0e0",borderWidth:1,layout:"horizontal"}),i=Ti.UI.createView({layout:"horizontal",top:3,left:0}),s=Ti.UI.createImageView({image:e.sender.image_url,width:50,top:0,left:0}),o=Ti.UI.createView({top:3,left:2,height:10}),u=Ti.UI.createView({top:0,left:5,backgroundColor:"e5eaf0",layout:"vertical"});messageSenderText=e.sender.name;var a=Ti.UI.createLabel({text:messageSenderText,width:"auto",color:"#5e656a",left:0,top:0,font:{fontSize:12}}),f=Ti.UI.createLabel({text:e.time,width:"auto",color:"black",right:3,top:0,font:{fontSize:11}});o.add(a,f),messageHtml='<div style = "font-size:15px"> <p>'+e.body+"</p></div>";var l=Ti.UI.createWebView({top:0,backgroundColor:"e5eaf0",width:hub.API.app_width-60,height:Ti.UI.SIZE,html:messageHtml});u.add(o),u.add(l),i.add(s,u),r.add(i),newHeight=0;var c=!1;return l.addEventListener("load",function(e){newHeight=parseInt(l.evalJS("document.height;"))+15,l.height=newHeight,l.top=0,u.height=newHeight,u.top=0,n.height=newHeight}),n.add(r),n},u=function(e){var t=Ti.UI.createTableViewRow({hasChild:!1,touchEnabled:!1,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,focusable:!1});return t.add(e),t},f=require("ui/common/UserView");win=new f,self=a(e),win.addContent(self);var l=function(){hub.API.newMessage()};return win.changeRightButtonEvent(l,"new"),thisWindow=win.appwin,thisWindow}module.exports=messageView