function MessageListView(e){function o(e){var t=[];hub.API.messages.getMessageThreads(t),hub.API.messages.hasMore()&&t.push("has_more"),tableRows=[];for(var n=0;n<t.length;n++)tableRows.push(r(t[n]));e.setData(tableRows)}function u(){var t=Ti.UI.createView({backgroundColor:hub.API.customBgColor,layout:"vertical"}),n=Ti.UI.createView({top:3,height:30,layout:"vertical"}),r=Ti.UI.createLabel({layout:"horizontal",top:3,text:e,color:hub.API.customTextColor,height:20,font:{fontWeight:"bold",fontSize:18},left:5}),i=Ti.UI.createTableView({top:0,separatorColor:"transparent",backgroundColor:hub.API.customBgColor});return o(i),i.addEventListener("click",function(e){var t=hub.API.messages.getMessages(e.index);if(t){MessageView=require("ui/common/dashboardViews/exploreViews/MessageView");var n=new MessageView(t);hub.API.openWindow(n)}}),n.add(r),t.add(n),t.add(i),t}hub=require("hub");var t=hub.API.app_width/5.1,n=(hub.API.app_width-350*hub.API.wsf)/2,r=function(e){var t=Ti.UI.createTableViewRow({hasChild:!1}),n=Ti.UI.createView({backgroundColor:"#e5eaf0",bottom:1,height:70,width:hub.API.app_width-2,right:1,left:0,borderColor:"#e0e0e0",borderWidth:1,layout:"horizontal"});if(e==="has_more")n.backgroundColor="#003a5f",titleImage=Ti.UI.createImageView({top:5,width:250,image:hub.API.imagePath("more.png")}),n.add(titleImage);else{var r=Ti.UI.createView({layout:"horizontal",top:0,left:0}),i=e.participants[e.participants.length-1],s=Ti.UI.createImageView({image:i.avatarUrl,width:50,top:0,left:0}),o=Ti.UI.createView({top:0,left:2}),u=Ti.UI.createView({top:0,left:5});messageSenderText=i.displayName,e.messageCount&&(messageSenderText=messageSenderText+"("+e.messageCount+")");var a=Ti.UI.createLabel({text:messageSenderText,width:"auto",color:"#5e656a",left:0,top:0,font:{fontSize:12}}),f=Ti.UI.createLabel({text:e.lastUpdatedFormatted,width:"auto",color:"black",right:3,top:0,font:{fontSize:11}});o.add(a,f);var l=Ti.UI.createLabel({text:e.messageSubject,width:"auto",color:"black",top:30,left:5,font:{fontSize:13}});u.add(o),u.add(l),r.add(s,u),n.add(r)}return t.add(n),t},i=function(e){var t=Ti.UI.createTableViewRow({hasChild:!1,touchEnabled:!1,selectionStyle:Ti.UI.iPhone.TableViewCellSelectionStyle.NONE,focusable:!1});return t.add(e),t},s=function(e,t){var n={start:function(){win.showIndicator("Fetching "+e+"...")},error:function(){Ti.API.info("Error Fetching "+e),win.hideIndicator()},success:function(){win.hideIndicator(),o(t)}};e==="people"?hub.API.fetchResults("users","most_recent",hub.API.messagelistResults.getPage()+1,n):hub.API.fetchResults(e,"most_recent",hub.API.messagelistResults.getPage()+1,n)},a=require("ui/common/UserView");messagelist_win=new a("Inbox"),self=u(),messagelist_win.addContent(self);var f=function(){hub.API.newMessage()};return messagelist_win.changeRightButtonEvent(f,"new"),thisWindow=messagelist_win.appwin,thisWindow}module.exports=MessageListView