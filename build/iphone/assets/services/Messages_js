function Messages(e,t,n){category=e,params=t,Connection=require("services/Connection");var r=new Connection({start:function(){n.start&&n.start()},error:function(){n.error&&n.error()},success:function(e){page=e.page,page==0&&(results=[]),e.hasMore==1?hasMore=!0:hasMore=!1;if(category==="message_threads/count")counts=e,n.success();else{_results=e.results;for(i=0;i<_results.length;i++)results.push(_results[i]);n.success()}}},e,[],"GET",t);this.getMessageThreads=function(e){for(i=0;i<results.length;i++)e.push(results[i])};var s=function(e,t){participants=results[t].participants;var n=0;while(n<participants.length){if(participants[n].id===parseInt(e))return participants[n];n++}return Ti.API.info("RED ALERT!! PARTICIPANT NOT FOUND "+e),Ti.API.info(JSON.stringify(participants)),null};this.getMessages=function(e,t){t={messages:[],recipient:{name:"",image_url:""}};var n=results[e].participants[0];recipient_details=s(n.participantPath.replace("/users/",""),e),t.recipient.name=recipient_details.displayName,t.recipient.image_url=recipient_details.avatarUrl,messages_input=results[e].messageContent;for(var r=0;r<messages_input.length;r++)message={sender:{},body:"",time:""},sender={name:"",image_url:""},participant_id=messages_input[r].user_id,participant=s(participant_id,e),sender.name=participant.displayName,sender.image_url=participant.avatarUrl,message.sender=sender,message.body=messages_input[r].body,message.time=messages_input[r].updated_at,t.messages.push(message);return t},this.getCounts=function(e){return counts[e]},this.isReady=function(){return isReady},this.hasMore=function(){return hasMore},this.getPage=function(){return page},this.changeReadyState=function(e){isReady=e}}var category=null,params=null,isReady=!1,results=[],counts={},hasMore=!1,page=0;module.exports=Messages